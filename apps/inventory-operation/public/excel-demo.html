<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Demo: Data Excel "Qu·∫£n L√Ω danh m·ª•c"</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .table-container {
            max-height: 600px;
            overflow-y: auto;
        }
        .editable-cell {
            cursor: pointer;
            transition: all 0.2s;
        }
        .editable-cell:hover {
            background-color: #f3f4f6;
        }
        .editing {
            background-color: #dbeafe !important;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen p-6">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">
                    üìä Demo: Data Excel "Qu·∫£n L√Ω danh m·ª•c"
                </h1>
                <p class="text-gray-600">
                    Test data th·ª±c t·∫ø t·ª´ file Excel v·ªõi giao di·ªán Excel-like editing
                </p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="text-sm font-medium text-gray-500">T·ªïng s·∫£n ph·∫©m</div>
                    <div class="text-2xl font-bold text-blue-600" id="total-products">17</div>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="text-sm font-medium text-gray-500">Lo·∫°i s·∫£n ph·∫©m</div>
                    <div class="text-2xl font-bold text-green-600" id="total-categories">7</div>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="text-sm font-medium text-gray-500">T·ªïng gi√° tr·ªã</div>
                    <div class="text-2xl font-bold text-purple-600" id="total-value">‚Ç´542,000</div>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="text-sm font-medium text-gray-500">Gi√° trung b√¨nh</div>
                    <div class="text-2xl font-bold text-orange-600" id="avg-price">‚Ç´31,882</div>
                </div>
            </div>

            <!-- Controls -->
            <div class="bg-white rounded-lg shadow p-6 mb-8">
                <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
                    <div class="flex flex-col md:flex-row gap-4 flex-1">
                        <input
                            type="text"
                            id="search-input"
                            placeholder="üîç T√¨m ki·∫øm s·∫£n ph·∫©m..."
                            class="px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                        <select
                            id="category-filter"
                            class="px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                            <option value="">T·∫•t c·∫£ lo·∫°i</option>
                            <option value="Nguy√™n li·ªáu">Nguy√™n li·ªáu</option>
                            <option value="ƒê·ªì u·ªëng">ƒê·ªì u·ªëng</option>
                            <option value="Th·ª©c ƒÉn">Th·ª©c ƒÉn</option>
                            <option value="B√°nh ng·ªçt">B√°nh ng·ªçt</option>
                            <option value="N∆∞·ªõc √©p">N∆∞·ªõc √©p</option>
                            <option value="Smoothie">Smoothie</option>
                            <option value="Combo">Combo</option>
                        </select>
                    </div>
                    <button
                        id="add-product-btn"
                        class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium"
                    >
                        + Th√™m s·∫£n ph·∫©m
                    </button>
                </div>
            </div>

            <!-- Data Table -->
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="table-container overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200" id="products-table">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">M√£ h√†ng</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">T√™n h√†ng</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ƒê∆°n v·ªã</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Gi√° b√°n</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lo·∫°i</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ghi ch√∫</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="products-tbody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Footer -->
            <div class="mt-8 text-center text-gray-500 text-sm">
                <p id="footer-stats">üìä Hi·ªÉn th·ªã 17 / 17 s·∫£n ph·∫©m</p>
                <p class="mt-2">
                    ‚ú® Demo data th·ª±c t·∫ø t·ª´ file Excel "Qu·∫£n L√Ω danh m·ª•c" v·ªõi t√≠nh nƒÉng Excel-like editing
                </p>
            </div>
        </div>
    </div>

    <script>
        // Real Excel data from "Qu·∫£n L√Ω danh m·ª•c" file
        let productsData = [
            // Nguy√™n li·ªáu - Raw Materials
            { id: 'NL001', code: 'NL-001', name: 'ƒê∆∞·ªùng tr·∫Øng', unit: 'Kg', price: 24000, category: 'Nguy√™n li·ªáu', notes: 'ƒê∆∞·ªùng tinh luy·ªán tr·∫Øng' },
            { id: 'NL002', code: 'NL-002', name: 'C√† ph√™ h·∫°t', unit: 'Kg', price: 180000, category: 'Nguy√™n li·ªáu', notes: 'C√† ph√™ Robusta rang v·ª´a' },
            { id: 'NL003', code: 'NL-003', name: 'S·ªØa t∆∞∆°i', unit: 'L√≠t', price: 28000, category: 'Nguy√™n li·ªáu', notes: 'S·ªØa t∆∞∆°i kh√¥ng ƒë∆∞·ªùng' },
            { id: 'NL004', code: 'NL-004', name: 'Tr√† xanh', unit: 'G√≥i', price: 15000, category: 'Nguy√™n li·ªáu', notes: 'Tr√† xanh t√∫i l·ªçc 100g' },
            { id: 'NL005', code: 'NL-005', name: 'B·ªôt m√¨', unit: 'Kg', price: 22000, category: 'Nguy√™n li·ªáu', notes: 'B·ªôt m√¨ ƒëa d·ª•ng s·ªë 8' },
            
            // Th√†nh ph·∫©m - Finished Products
            { id: 'TP001', code: 'TP-001', name: 'C√† ph√™ ƒëen', unit: 'Ly', price: 20000, category: 'ƒê·ªì u·ªëng', notes: 'C√† ph√™ phin truy·ªÅn th·ªëng' },
            { id: 'TP002', code: 'TP-002', name: 'C√† ph√™ s·ªØa', unit: 'Ly', price: 25000, category: 'ƒê·ªì u·ªëng', notes: 'C√† ph√™ phin v·ªõi s·ªØa ƒë·∫∑c' },
            { id: 'TP003', code: 'TP-003', name: 'Tr√† s·ªØa tr√¢n ch√¢u', unit: 'Ly', price: 35000, category: 'ƒê·ªì u·ªëng', notes: 'Tr√† s·ªØa ƒê√†i Loan v·ªõi tr√¢n ch√¢u ƒëen' },
            { id: 'TP004', code: 'TP-004', name: 'Tr√† xanh ƒë√°', unit: 'Ly', price: 18000, category: 'ƒê·ªì u·ªëng', notes: 'Tr√† xanh pha l·∫°nh' },
            { id: 'TP005', code: 'TP-005', name: 'B√°nh m√¨ th·ªãt n∆∞·ªõng', unit: '·ªî', price: 25000, category: 'Th·ª©c ƒÉn', notes: 'B√°nh m√¨ Vi·ªát Nam v·ªõi th·ªãt n∆∞·ªõng' },
            { id: 'TP006', code: 'TP-006', name: 'B√°nh croissant', unit: 'C√°i', price: 30000, category: 'B√°nh ng·ªçt', notes: 'B√°nh croissant b∆° Ph√°p' },
            { id: 'TP007', code: 'TP-007', name: 'B√°nh tiramisu', unit: 'Ph·∫ßn', price: 45000, category: 'B√°nh ng·ªçt', notes: 'B√°nh tiramisu √ù truy·ªÅn th·ªëng' },
            { id: 'TP008', code: 'TP-008', name: 'N∆∞·ªõc cam v·∫Øt', unit: 'Ly', price: 30000, category: 'N∆∞·ªõc √©p', notes: 'Cam t∆∞∆°i v·∫Øt 100%' },
            { id: 'TP009', code: 'TP-009', name: 'Smoothie xo√†i', unit: 'Ly', price: 40000, category: 'Smoothie', notes: 'Xo√†i t∆∞∆°i xay v·ªõi s·ªØa chua' },
            { id: 'TP010', code: 'TP-010', name: 'Smoothie d√¢u', unit: 'Ly', price: 42000, category: 'Smoothie', notes: 'D√¢u t√¢y t∆∞∆°i xay v·ªõi s·ªØa' },
            
            // Combo & Set
            { id: 'CB001', code: 'CB-001', name: 'Combo s√°ng', unit: 'Set', price: 55000, category: 'Combo', notes: 'C√† ph√™ s·ªØa + B√°nh m√¨ + Tr·ª©ng ·ªëp la' },
            { id: 'CB002', code: 'CB-002', name: 'Combo chi·ªÅu', unit: 'Set', price: 65000, category: 'Combo', notes: 'Tr√† s·ªØa + B√°nh ng·ªçt + Snack' }
        ];

        let filteredData = [...productsData];
        let editingCell = null;

        // Format price in VND
        function formatPrice(price) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(price);
        }

        // Update statistics
        function updateStats() {
            const total = filteredData.length;
            const categories = new Set(filteredData.map(item => item.category)).size;
            const totalValue = filteredData.reduce((sum, item) => sum + item.price, 0);
            const avgPrice = totalValue / total;

            document.getElementById('total-products').textContent = total;
            document.getElementById('total-categories').textContent = categories;
            document.getElementById('total-value').textContent = formatPrice(totalValue);
            document.getElementById('avg-price').textContent = formatPrice(avgPrice);
            document.getElementById('footer-stats').textContent = `üìä Hi·ªÉn th·ªã ${total} / ${productsData.length} s·∫£n ph·∫©m`;
        }

        // Render table
        function renderTable() {
            const tbody = document.getElementById('products-tbody');
            tbody.innerHTML = '';

            filteredData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 editable-cell" data-field="code" data-id="${item.id}">${item.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 editable-cell" data-field="name" data-id="${item.id}">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 editable-cell" data-field="unit" data-id="${item.id}">${item.unit}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600 editable-cell" data-field="price" data-id="${item.id}">${formatPrice(item.price)}</td>
                    <td class="px-6 py-4 whitespace-nowrap editable-cell" data-field="category" data-id="${item.id}">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${item.category}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate editable-cell" data-field="notes" data-id="${item.id}">${item.notes}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="deleteProduct('${item.id}')" class="text-red-600 hover:text-red-800">
                            üóëÔ∏è
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Add click listeners for editable cells
            document.querySelectorAll('.editable-cell').forEach(cell => {
                cell.addEventListener('click', handleCellClick);
            });

            updateStats();
        }

        // Handle cell click for editing
        function handleCellClick(event) {
            const cell = event.target;
            const field = cell.dataset.field;
            const id = cell.dataset.id;
            const currentValue = cell.textContent.trim();

            if (editingCell) {
                finishEditing();
            }

            editingCell = { cell, field, id, originalValue: currentValue };
            cell.classList.add('editing');

            let input;
            if (field === 'price') {
                const numericValue = productsData.find(p => p.id === id).price;
                input = document.createElement('input');
                input.type = 'number';
                input.value = numericValue;
                input.className = 'w-full px-2 py-1 border border-blue-300 rounded text-sm';
            } else if (field === 'unit') {
                input = document.createElement('select');
                input.className = 'w-full px-2 py-1 border border-blue-300 rounded text-sm';
                const units = ['Ly', 'C√°i', 'Ph·∫ßn', '·ªî', 'Set', 'Kg', 'G√≥i', 'L√≠t'];
                units.forEach(unit => {
                    const option = document.createElement('option');
                    option.value = unit;
                    option.textContent = unit;
                    if (unit === currentValue) option.selected = true;
                    input.appendChild(option);
                });
            } else if (field === 'category') {
                input = document.createElement('select');
                input.className = 'w-full px-2 py-1 border border-blue-300 rounded text-sm';
                const categories = ['Nguy√™n li·ªáu', 'ƒê·ªì u·ªëng', 'Th·ª©c ƒÉn', 'B√°nh ng·ªçt', 'N∆∞·ªõc √©p', 'Smoothie', 'Combo'];
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    if (cat === currentValue) option.selected = true;
                    input.appendChild(option);
                });
            } else {
                input = document.createElement('input');
                input.type = 'text';
                input.value = currentValue;
                input.className = 'w-full px-2 py-1 border border-blue-300 rounded text-sm';
            }

            input.addEventListener('blur', finishEditing);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    finishEditing();
                } else if (e.key === 'Escape') {
                    cancelEditing();
                }
            });

            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
        }

        // Finish editing
        function finishEditing() {
            if (!editingCell) return;

            const { cell, field, id } = editingCell;
            const input = cell.querySelector('input, select');
            const newValue = input.value;

            // Update data
            const product = productsData.find(p => p.id === id);
            if (product) {
                if (field === 'price') {
                    product[field] = parseInt(newValue) || 0;
                } else {
                    product[field] = newValue;
                }
            }

            cell.classList.remove('editing');
            editingCell = null;
            
            // Re-render to show updated data
            filterAndRender();
        }

        // Cancel editing
        function cancelEditing() {
            if (!editingCell) return;

            const { cell, originalValue } = editingCell;
            cell.classList.remove('editing');
            cell.textContent = originalValue;
            editingCell = null;
        }

        // Delete product
        function deleteProduct(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')) {
                productsData = productsData.filter(p => p.id !== id);
                filterAndRender();
            }
        }

        // Add new product
        function addProduct() {
            const newId = 'NEW' + Date.now();
            const newProduct = {
                id: newId,
                code: '',
                name: '',
                unit: 'Ly',
                price: 0,
                category: 'ƒê·ªì u·ªëng',
                notes: ''
            };
            productsData.push(newProduct);
            filterAndRender();
            
            // Auto-focus on the first cell of the new product after rendering
            setTimeout(() => {
                const newRowCells = document.querySelectorAll(`[data-id="${newId}"]`);
                if (newRowCells.length > 0) {
                    // Focus on the first cell (product code)
                    const firstCell = newRowCells[0];
                    firstCell.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstCell.click();
                }
            }, 100);
        }

        // Filter and render
        function filterAndRender() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const categoryFilter = document.getElementById('category-filter').value;

            filteredData = productsData.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm) ||
                                    item.code.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || item.category === categoryFilter;
                return matchesSearch && matchesCategory;
            });

            renderTable();
        }

        // Event listeners
        document.getElementById('search-input').addEventListener('input', filterAndRender);
        document.getElementById('category-filter').addEventListener('change', filterAndRender);
        document.getElementById('add-product-btn').addEventListener('click', addProduct);

        // Initial render
        renderTable();

        // Handle clicks outside of editing cells
        document.addEventListener('click', (e) => {
            if (editingCell && !e.target.closest('.editable-cell')) {
                finishEditing();
            }
        });
    </script>
</body>
</html>
